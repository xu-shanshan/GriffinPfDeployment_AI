<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OwaMailB2 - Service Detail | Griffin PF Deployment AI</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/feather-icons"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; }
        .gradient-bg { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .card-hover { transition: all 0.3s ease; }
        .card-hover:hover { transform: translateY(-2px); box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
        
        /* Pipeline card color themes */
        .pipeline-blue { border-color: #3B82F6; background-color: #EFF6FF; }
        .pipeline-blue .icon-bg { background-color: #DBEAFE; }
        .pipeline-blue .icon { color: #3B82F6; }
        .pipeline-blue .btn-primary { background-color: #3B82F6; }
        .pipeline-blue .btn-primary:hover { background-color: #2563EB; }
        .pipeline-blue .badge { background-color: #DBEAFE; color: #3B82F6; }
        
        .pipeline-purple { border-color: #8B5CF6; background-color: #F3E8FF; }
        .pipeline-purple .icon-bg { background-color: #E9D5FF; }
        .pipeline-purple .icon { color: #8B5CF6; }
        .pipeline-purple .btn-primary { background-color: #8B5CF6; }
        .pipeline-purple .btn-primary:hover { background-color: #7C3AED; }
        .pipeline-purple .badge { background-color: #E9D5FF; color: #8B5CF6; }
        
        .pipeline-green { border-color: #10B981; background-color: #ECFDF5; }
        .pipeline-green .icon-bg { background-color: #D1FAE5; }
        .pipeline-green .icon { color: #10B981; }
        .pipeline-green .btn-primary { background-color: #10B981; }
        .pipeline-green .btn-primary:hover { background-color: #059669; }
        .pipeline-green .badge { background-color: #D1FAE5; color: #10B981; }
        
        .pipeline-orange { border-color: #F59E0B; background-color: #FFFBEB; }
        .pipeline-orange .icon-bg { background-color: #FEF3C7; }
        .pipeline-orange .icon { color: #F59E0B; }
        .pipeline-orange .btn-primary { background-color: #F59E0B; }
        .pipeline-orange .btn-primary:hover { background-color: #D97706; }
        .pipeline-orange .badge { background-color: #FEF3C7; color: #F59E0B; }

        .pipeline-card.default-pipeline {
            ring: 2px solid #3B82F6;
            ring-opacity: 0.5;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-gray-50 to-gray-100 min-h-screen">
    <!-- Navigation -->
    <nav class="gradient-bg text-white shadow-lg sticky top-0 z-40">
        <div class="container mx-auto px-6">
            <div class="flex justify-between items-center py-4">
                <div class="flex items-center space-x-3">
                    <div class="w-8 h-8 bg-white bg-opacity-20 rounded-lg flex items-center justify-center">
                        <i data-feather="layers" class="w-5 h-5"></i>
                    </div>
                    <div>
                        <h1 class="text-xl font-bold">Griffin PF Deployment AI</h1>
                        <p class="text-xs text-blue-100 opacity-80">Virtual Environment Management</p>
                    </div>
                </div>
                <div class="flex items-center space-x-2">
                    <a href="dashboard.html" class="px-4 py-2 rounded-lg hover:bg-white hover:bg-opacity-10 transition-all">
                        <i data-feather="home" class="w-4 h-4 inline mr-2"></i>Dashboard
                    </a>
                    <a href="ve-management.html" class="px-4 py-2 rounded-lg hover:bg-white hover:bg-opacity-10 transition-all">
                        <i data-feather="server" class="w-4 h-4 inline mr-2"></i>VE Management
                    </a>
                    <a href="deployment-history.html" class="px-4 py-2 rounded-lg hover:bg-white hover:bg-opacity-10 transition-all">
                        <i data-feather="clock" class="w-4 h-4 inline mr-2"></i>History
                    </a>
                    <a href="settings.html" class="px-4 py-2 rounded-lg hover:bg-white hover:bg-opacity-10 transition-all">
                        <i data-feather="settings" class="w-4 h-4 inline mr-2"></i>Settings
                    </a>
                    <div class="h-6 w-px bg-white bg-opacity-20 mx-2"></div>
                    <div class="flex items-center space-x-3">
                        <div class="w-8 h-8 bg-white bg-opacity-20 rounded-full flex items-center justify-center">
                            <i data-feather="user" class="w-4 h-4"></i>
                        </div>
                        <a href="login.html" class="text-blue-100 hover:text-white transition-colors text-sm">
                            <i data-feather="log-out" class="w-4 h-4 inline mr-1"></i>Logout
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <div class="container mx-auto px-6 py-8">
        <!-- Breadcrumb -->
        <nav class="flex items-center space-x-2 text-sm text-gray-600 mb-6" aria-label="Breadcrumb">
            <a href="ve-management.html" class="hover:text-blue-600 transition-colors">VE Management</a>
            <i data-feather="chevron-right" class="w-4 h-4"></i>
            <a href="ve-detail.html?ve=OwaMailB2-SOV" class="hover:text-blue-600 transition-colors">OwaMailB2-SOV</a>
            <i data-feather="chevron-right" class="w-4 h-4"></i>
            <span class="text-gray-900 font-medium">OwaMailB2</span>
        </nav>

        <!-- Enhanced Service Header with Improved Status Indicators -->
        <div class="bg-white rounded-xl shadow-sm border border-gray-100 mb-8">
            <div class="p-8">
                <div class="flex items-center justify-between mb-6">
                    <div class="flex items-center space-x-4">
                        <div class="w-16 h-16 bg-gradient-to-br from-green-500 to-teal-600 rounded-xl flex items-center justify-center">
                            <i data-feather="mail" class="w-8 h-8 text-white"></i>
                        </div>
                        <div>
                            <div class="flex items-center space-x-3 mb-1">
                                <h1 class="text-3xl font-bold text-gray-900">OwaMailB2</h1>
                                <button onclick="toggleFavorite()" class="text-gray-400 hover:text-yellow-500 transition-colors" id="favoriteBtn">
                                    <i data-feather="star" class="w-6 h-6"></i>
                                </button>
                            </div>
                            <p class="text-gray-600 mt-1">Outlook Web App Mail Backend Service</p>
                            <div class="flex items-center space-x-4 mt-3">
                                <span class="px-3 py-1 bg-blue-100 text-blue-800 text-sm font-medium rounded-full">RingPromotion</span>
                                <span class="px-3 py-1 bg-emerald-100 text-emerald-800 text-sm font-medium rounded-full">B2 Type</span>
                                <span class="text-sm text-gray-500">VE: OwaMailB2-SOV</span>
                                <span class="text-sm text-gray-500">Last Deployed: 2024-12-20 14:30:25</span>
                            </div>
                        </div>
                    </div>
                    <div class="flex items-center space-x-3">
                        <div class="text-right">
                            <div class="flex items-center space-x-2 mb-1">
                                <div class="w-2 h-2 bg-green-400 rounded-full animate-pulse"></div>
                                <span class="text-sm font-medium text-green-600">Healthy</span>
                            </div>
                            <div class="text-xs text-gray-500">Version: 20241220.5</div>
                        </div>
                        <button onclick="showConfigEditor()" class="px-4 py-2.5 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium">
                            <i data-feather="edit-3" class="w-4 h-4 inline mr-2"></i>Edit Configuration
                        </button>
                        <button class="px-4 py-2.5 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors font-medium">
                            <i data-feather="settings" class="w-4 h-4 inline mr-2"></i>Settings
                        </button>
                    </div>
                </div>
                
                <!-- Key Metrics Display -->
                <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mt-6">
                    <div class="bg-blue-50 rounded-lg p-4 border border-blue-100">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-blue-600 font-medium">Successful Deployments</p>
                                <p class="text-2xl font-bold text-blue-900 mt-1">127</p>
                            </div>
                            <i data-feather="check-circle" class="w-8 h-8 text-blue-500"></i>
                        </div>
                    </div>
                    <div class="bg-green-50 rounded-lg p-4 border border-green-100">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-green-600 font-medium">Uptime</p>
                                <p class="text-2xl font-bold text-green-900 mt-1">99.8%</p>
                            </div>
                            <i data-feather="trending-up" class="w-8 h-8 text-green-500"></i>
                        </div>
                    </div>
                    <div class="bg-purple-50 rounded-lg p-4 border border-purple-100">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-purple-600 font-medium">Active Pipelines</p>
                                <p class="text-2xl font-bold text-purple-900 mt-1">3</p>
                            </div>
                            <i data-feather="zap" class="w-8 h-8 text-purple-500"></i>
                        </div>
                    </div>
                    <div class="bg-orange-50 rounded-lg p-4 border border-orange-100">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-orange-600 font-medium">Avg Deploy Time</p>
                                <p class="text-2xl font-bold text-orange-900 mt-1">12m</p>
                            </div>
                            <i data-feather="clock" class="w-8 h-8 text-orange-500"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Quick Deploy Interface -->
        <div class="bg-white rounded-xl shadow-sm border border-gray-100 mb-8">
            <div class="p-6 border-b border-gray-100 bg-gradient-to-r from-green-50 to-emerald-50">
                <div class="flex items-center space-x-3">
                    <div class="w-10 h-10 bg-gradient-to-br from-green-500 to-emerald-600 rounded-lg flex items-center justify-center">
                        <i data-feather="play" class="w-5 h-5 text-white"></i>
                    </div>
                    <div>
                        <h3 class="text-xl font-semibold text-gray-900">Quick Deploy</h3>
                        <p class="text-sm text-gray-500">Deploy with default settings or customize your deployment</p>
                    </div>
                </div>
            </div>
            
            <div class="p-6">
                <div class="flex flex-col lg:flex-row lg:items-center justify-between space-y-4 lg:space-y-0">
                    <div class="flex flex-col md:flex-row md:items-center space-y-4 md:space-y-0 md:space-x-4">
                        <div class="flex items-center space-x-3">
                            <label class="text-sm font-medium text-gray-700">Pipeline:</label>
                            <select id="quickPipelineSelect" class="px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent">
                                <option value="1418">Main Pipeline (Default)</option>
                                <option value="33874">Incremental Build</option>
                                <option value="custom">Custom Pipeline</option>
                            </select>
                        </div>
                        <div class="flex items-center space-x-3">
                            <label class="text-sm font-medium text-gray-700">Version:</label>
                            <select id="quickVersionSelect" class="px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent">
                                <option value="latest">Latest (20241220.5)</option>
                                <option value="20241220.4">20241220.4</option>
                                <option value="20241220.3">20241220.3</option>
                            </select>
                        </div>
                    </div>
                    <div class="flex space-x-3">
                        <button onclick="showAdvancedDeploy()" class="px-4 py-2 text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors">
                            <i data-feather="settings" class="w-4 h-4 inline mr-2"></i>Advanced Options
                        </button>
                        <button onclick="quickDeploy()" class="px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors font-medium">
                            <i data-feather="play" class="w-4 h-4 inline mr-2"></i>Deploy Now
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <div class="grid grid-cols-1 gap-8">
            <!-- Pipeline Management Cards -->
            <div class="bg-white rounded-xl shadow-sm border border-gray-100">
                <div class="p-6 border-b border-gray-100 bg-gradient-to-r from-gray-50 to-white">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center space-x-3">
                            <div class="w-10 h-10 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-lg flex items-center justify-center">
                                <i data-feather="layers" class="w-5 h-5 text-white"></i>
                            </div>
                            <div>
                                <h3 class="text-xl font-semibold text-gray-900">Pipeline Management</h3>
                                <p class="text-sm text-gray-500">Manage and configure deployment pipelines</p>
                            </div>
                        </div>
                        <div class="flex items-center space-x-2">
                            <span class="text-sm text-gray-600">Default Pipeline:</span>
                            <span id="currentDefaultPipeline" class="px-3 py-1 bg-blue-100 text-blue-800 text-sm font-medium rounded-full">Main Pipeline (ID: 1418)</span>
                        </div>
                    </div>
                </div>
                
                <div class="p-6">
                    <div id="pipelineCardsContainer" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                        <!-- Pipeline cards will be dynamically generated -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Advanced Deployment Configuration Modal -->
        <div id="advancedDeployModal" class="hidden fixed inset-0 bg-gray-900 bg-opacity-50 flex items-center justify-center z-50">
            <div class="bg-white rounded-xl shadow-xl max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto">
                <div class="p-6 border-b border-gray-100">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center space-x-3">
                            <i data-feather="settings" class="w-6 h-6 text-blue-600"></i>
                            <h3 class="text-lg font-semibold text-gray-900">Advanced Deployment Configuration</h3>
                        </div>
                        <button onclick="closeAdvancedDeploy()" class="text-gray-400 hover:text-gray-600">
                            <i data-feather="x" class="w-5 h-5"></i>
                        </button>
                    </div>
                </div>
                
                <div class="p-6">
                    <div class="space-y-6">
                        <!-- Pipeline Selection -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-3">Pipeline Selection</label>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                                <label class="relative">
                                    <input type="radio" name="deployPipeline" value="1418" checked class="sr-only">
                                    <div class="pipeline-option p-4 border rounded-lg cursor-pointer hover:border-blue-300 transition-all">
                                        <div class="flex items-center space-x-3">
                                            <i data-feather="zap" class="w-5 h-5 text-blue-600"></i>
                                            <div>
                                                <p class="font-medium text-gray-900">Main Pipeline</p>
                                                <p class="text-sm text-gray-500">Full build with all features</p>
                                            </div>
                                        </div>
                                    </div>
                                </label>
                                <label class="relative">
                                    <input type="radio" name="deployPipeline" value="33874" class="sr-only">
                                    <div class="pipeline-option p-4 border rounded-lg cursor-pointer hover:border-blue-300 transition-all">
                                        <div class="flex items-center space-x-3">
                                            <i data-feather="refresh-cw" class="w-5 h-5 text-purple-600"></i>
                                            <div>
                                                <p class="font-medium text-gray-900">Incremental Build</p>
                                                <p class="text-sm text-gray-500">Faster, incremental changes</p>
                                            </div>
                                        </div>
                                    </div>
                                </label>
                            </div>
                        </div>

                        <!-- Version Selection with Real-time Preview -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Build Version</label>
                            <div class="flex space-x-3">
                                <select id="modalVersionSelect" class="flex-1 p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" onchange="updateDropUrlPreview()">
                                    <option value="latest">Latest (20241220.5)</option>
                                    <option value="20241220.4">20241220.4</option>
                                    <option value="20241220.3">20241220.3</option>
                                </select>
                                <button class="px-4 py-3 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors">
                                    <i data-feather="refresh-cw" class="w-4 h-4"></i>
                                </button>
                            </div>
                            <div class="mt-2 p-3 bg-gray-50 rounded-lg">
                                <p class="text-xs text-gray-500 mb-1">Drop URL Preview:</p>
                                <p id="modalDropUrlPreview" class="text-xs font-mono text-gray-700 break-all">VSO://https://outlookweb.artifacts.visualstudio.com/DefaultCollection/_apis/drop/drops/owamailb2_ms/20241220.5?root=autopilot</p>
                            </div>
                        </div>

                        <!-- PR Workflow Integration -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">PR Workflow</label>
                            <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                                <div class="flex items-start space-x-3">
                                    <i data-feather="git-pull-request" class="w-5 h-5 text-blue-600 mt-0.5"></i>
                                    <div>
                                        <p class="text-sm font-medium text-blue-900">Create Pull Request</p>
                                        <p class="text-xs text-blue-700 mt-1">Automatically create PR for configuration changes</p>
                                        <label class="flex items-center mt-2">
                                            <input type="checkbox" id="createPR" class="mr-2 rounded border-gray-300">
                                            <span class="text-xs text-blue-800">Enable PR workflow</span>
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="px-6 py-4 border-t border-gray-100 flex justify-end space-x-3">
                    <button onclick="closeAdvancedDeploy()" class="px-4 py-2 text-gray-600 hover:text-gray-800 transition-colors">Cancel</button>
                    <button onclick="confirmAdvancedDeploy()" class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                        <i data-feather="play" class="w-4 h-4 inline mr-2"></i>Deploy
                    </button>
                </div>
            </div>
        </div>

        <!-- Service Configuration Editor Modal -->
        <div id="configEditorModal" class="hidden fixed inset-0 bg-gray-900 bg-opacity-50 flex items-center justify-center z-50">
            <div class="bg-white rounded-xl shadow-xl max-w-4xl w-full mx-4 max-h-[90vh] flex flex-col">
                <div class="p-6 border-b border-gray-100 flex-shrink-0">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center space-x-3">
                            <i data-feather="edit-3" class="w-6 h-6 text-purple-600"></i>
                            <h3 class="text-lg font-semibold text-gray-900">Edit Service Configuration</h3>
                        </div>
                        <button onclick="closeConfigEditor()" class="text-gray-400 hover:text-gray-600">
                            <i data-feather="x" class="w-5 h-5"></i>
                        </button>
                    </div>
                </div>
                
                <div class="flex-1 flex overflow-hidden">
                    <!-- Configuration Editor -->
                    <div class="flex-1 p-6 overflow-y-auto">
                        <div class="space-y-4">
                            <div class="flex items-center justify-between mb-4">
                                <h4 class="text-sm font-medium text-gray-700">Service: OwaMailB2</h4>
                                <div class="flex items-center space-x-2">
                                    <button onclick="validateConfig()" class="px-3 py-1.5 bg-blue-100 text-blue-700 rounded-md hover:bg-blue-200 transition-colors text-sm">
                                        <i data-feather="check-circle" class="w-3 h-3 inline mr-1"></i>Validate
                                    </button>
                                    <button onclick="resetConfig()" class="px-3 py-1.5 bg-gray-100 text-gray-700 rounded-md hover:bg-gray-200 transition-colors text-sm">
                                        <i data-feather="refresh-cw" class="w-3 h-3 inline mr-1"></i>Reset
                                    </button>
                                </div>
                            </div>
                            
                            <!-- JSON Editor -->
                            <div class="relative">
                                <label class="block text-sm font-medium text-gray-700 mb-2">Configuration JSON</label>
                                <div class="border border-gray-300 rounded-lg overflow-hidden">
                                    <div class="bg-gray-50 px-4 py-2 border-b border-gray-200 flex items-center justify-between">
                                        <div class="flex items-center space-x-2">
                                            <span class="text-xs text-gray-500">JSON Editor</span>
                                            <div id="configStatus" class="flex items-center space-x-1">
                                                <div class="w-2 h-2 bg-green-400 rounded-full"></div>
                                                <span class="text-xs text-green-600">Valid</span>
                                            </div>
                                        </div>
                                        <button onclick="formatConfig()" class="text-xs text-gray-500 hover:text-gray-700">Format</button>
                                    </div>
                                    <textarea id="configEditor" class="w-full h-96 p-4 font-mono text-sm resize-none focus:outline-none focus:ring-2 focus:ring-blue-500" spellcheck="false">
{
  "BuildType": "RingPromotion",
  "PipelineId": 1418,
  "IncrementalBuildPipelineId": 33874,
  "RingPromotionRootPath": "autopilot",
  "BuildRoot": "https://outlookgriffinservice.blob.core.windows.net/owamailb2/prod_image.txt",
  "PpeVeName": "OwaMailB2-PPE",
  "BuildPathPattern": "VSO://https://outlookweb.artifacts.visualstudio.com/DefaultCollection/_apis/drop/drops/owamailb2_ms/<BuildVersion>?root=autopilot"
}</textarea>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Configuration Diff Preview -->
                    <div id="configDiff" class="hidden w-1/2 border-l border-gray-200 p-6 overflow-y-auto">
                        <h4 class="text-sm font-medium text-gray-700 mb-4">Configuration Changes</h4>
                        <div class="space-y-3">
                            <div class="bg-green-50 border border-green-200 rounded-lg p-3">
                                <div class="flex items-center space-x-2 mb-2">
                                    <i data-feather="plus" class="w-3 h-3 text-green-600"></i>
                                    <span class="text-xs font-medium text-green-700">Added</span>
                                </div>
                                <pre class="text-xs text-green-800 font-mono">+ "MainlineBuildPipelineId": 31235</pre>
                            </div>
                            <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-3">
                                <div class="flex items-center space-x-2 mb-2">
                                    <i data-feather="edit-2" class="w-3 h-3 text-yellow-600"></i>
                                    <span class="text-xs font-medium text-yellow-700">Modified</span>
                                </div>
                                <pre class="text-xs text-gray-600 font-mono">- "PipelineId": 1418</pre>
                                <pre class="text-xs text-yellow-800 font-mono">+ "PipelineId": 1420</pre>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="px-6 py-4 border-t border-gray-100 flex justify-between items-center flex-shrink-0">
                    <div class="flex items-center space-x-3">
                        <label class="flex items-center">
                            <input type="checkbox" id="createPRConfig" checked class="mr-2 rounded border-gray-300">
                            <span class="text-sm text-gray-700">Create Pull Request</span>
                        </label>
                        <button onclick="toggleDiffView()" class="text-sm text-blue-600 hover:text-blue-800">
                            <i data-feather="eye" class="w-3 h-3 inline mr-1"></i>Preview Changes
                        </button>
                    </div>
                    <div class="flex space-x-3">
                        <button onclick="closeConfigEditor()" class="px-4 py-2 text-gray-600 hover:text-gray-800 transition-colors">Cancel</button>
                        <button onclick="saveConfiguration()" class="px-6 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors">
                            <i data-feather="save" class="w-4 h-4 inline mr-2"></i>Save Configuration
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- PR Creation Confirmation Modal -->
        <div id="prConfirmModal" class="hidden fixed inset-0 bg-gray-900 bg-opacity-50 flex items-center justify-center z-50">
            <div class="bg-white rounded-xl shadow-xl max-w-md w-full mx-4">
                <div class="p-6">
                    <div class="flex items-center mb-4">
                        <i data-feather="git-pull-request" class="w-6 h-6 text-green-600 mr-3"></i>
                        <h3 class="text-lg font-semibold text-gray-900">Create Pull Request</h3>
                    </div>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">PR Title</label>
                            <input type="text" id="prTitle" value="Update OwaMailB2 service configuration" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Description</label>
                            <textarea id="prDescription" rows="3" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent" placeholder="Describe the changes made to the service configuration...">Updated service configuration for OwaMailB2:
- Modified PipelineId from 1418 to 1420
- Added MainlineBuildPipelineId: 31235</textarea>
                        </div>
                        <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                            <div class="flex items-start space-x-3">
                                <i data-feather="info" class="w-5 h-5 text-blue-600 mt-0.5"></i>
                                <div>
                                    <p class="text-sm font-medium text-blue-900">Configuration Changes</p>
                                    <ul class="text-xs text-blue-700 mt-1 space-y-1">
                                        <li>• Service: OwaMailB2</li>
                                        <li>• Changes: 2 modifications, 1 addition</li>
                                        <li>• Impact: Build pipeline configuration</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="px-6 py-4 border-t border-gray-100 flex justify-end space-x-3">
                    <button onclick="closePRModal()" class="px-4 py-2 text-gray-600 hover:text-gray-800 transition-colors">Cancel</button>
                    <button onclick="createPullRequest()" class="px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors">
                        <i data-feather="git-pull-request" class="w-4 h-4 inline mr-2"></i>Create PR
                    </button>
                </div>
            </div>
        </div>

        <script>
            // Service configuration data (this would come from API in real implementation)
            const serviceConfig = {
                "OwaMailB2": {
                    "BuildType": "RingPromotion",
                    "PipelineId": 1418,
                    "IncrementalBuildPipelineId": 33874,
                    "RingPromotionRootPath": "autopilot",
                    "BuildRoot": "https://outlookgriffinservice.blob.core.windows.net/owamailb2/prod_image.txt",
                    "PpeVeName": "OwaMailB2-PPE",
                    "BuildPathPattern": "VSO://https://outlookweb.artifacts.visualstudio.com/DefaultCollection/_apis/drop/drops/owamailb2_ms/<BuildVersion>?root=autopilot"
                }
            };

            // Pipeline metadata and configurations
            const pipelineConfigs = {
                1418: {
                    name: "Main Pipeline",
                    description: "Primary build pipeline for OwaMailB2",
                    type: "main",
                    color: "blue",
                    icon: "zap",
                    isDefault: true,
                    latestBuild: "20241220.5",
                    dropUrl: "VSO://https://outlookweb.artifacts.visualstudio.com/DefaultCollection/_apis/drop/drops/owamailb2_ms/20241220.5?root=autopilot"
                },
                33874: {
                    name: "Incremental Build",
                    description: "Fast incremental build pipeline",
                    type: "incremental",
                    color: "purple",
                    icon: "refresh-cw",
                    isDefault: false,
                    latestBuild: "20241220.3",
                    dropUrl: "VSO://https://outlookweb.artifacts.visualstudio.com/DefaultCollection/_apis/drop/drops/owamailb2_ms/20241220.3?root=autopilot"
                },
                31234: {
                    name: "Incremental Build",
                    description: "Fast incremental changes",
                    type: "incremental",
                    color: "purple",
                    icon: "refresh-cw",
                    isDefault: false,
                    latestBuild: "20241220.2",
                    dropUrl: "VSO://https://outlookweb.artifacts.visualstudio.com/DefaultCollection/_apis/drop/drops/owamailb2_ms/20241220.2?root=autopilot"
                },
                31235: {
                    name: "Mainline Build",
                    description: "Full mainline build pipeline",
                    type: "mainline",
                    color: "green",
                    icon: "git-branch",
                    isDefault: false,
                    latestBuild: "20241220.1",
                    dropUrl: "VSO://https://ossinfra.artifacts.visualstudio.com/DefaultCollection/_apis/drop/drops/secondary/OSS_RoutingPlane_Retail_Drops_Signing_Git/Sec.1.0.0.20241220.1"
                },
                31238: {
                    name: "Release Pipeline",
                    description: "Production release pipeline",
                    type: "release",
                    color: "orange",
                    icon: "upload",
                    isDefault: true,
                    latestBuild: "20241220.4",
                    dropUrl: "VSO://https://ossinfra.artifacts.visualstudio.com/DefaultCollection/_apis/drop/drops/secondary/OSS_RoutingPlane_Retail_Drops_Signing_Git/Sec.1.0.0.20241220.4"
                }
            };

            // Initialize Feather icons
            feather.replace();

            // Current service (would be passed from URL params in real implementation)
            const currentService = "OwaMailB2";

            // Global state for default pipeline management
            let pendingDefaultPipelineId = null;
            let currentDefaultPipelineId = 1418; // Initially set to main pipeline

            // Initialize the page
            document.addEventListener('DOMContentLoaded', function() {
                console.log('Initializing page...'); // Debug log
                initializePipelines();
                updateConfigEditor();
                updateQuickDeployOptions();
                updateAdvancedDeployModal();
                updateDefaultPipelineDisplay();
            });

            function initializePipelines() {
                console.log('Initializing pipelines...'); // Debug log
                const service = serviceConfig[currentService];
                if (!service) {
                    console.error('Service not found:', currentService);
                    return;
                }

                const container = document.getElementById('pipelineCardsContainer');
                if (!container) {
                    console.error('Pipeline container not found');
                    return;
                }
                
                container.innerHTML = '';

                // Extract all pipeline IDs from service config
                const pipelineIds = [];
                if (service.PipelineId) pipelineIds.push({ id: service.PipelineId, role: 'primary' });
                if (service.IncrementalBuildPipelineId) pipelineIds.push({ id: service.IncrementalBuildPipelineId, role: 'incremental' });
                if (service.MainlineBuildPipelineId) pipelineIds.push({ id: service.MainlineBuildPipelineId, role: 'mainline' });

                console.log('Found pipeline IDs:', pipelineIds); // Debug log

                // Create pipeline cards
                pipelineIds.forEach(({ id, role }) => {
                    const config = pipelineConfigs[id];
                    if (config) {
                        console.log('Creating card for pipeline:', id, config); // Debug log
                        const card = createPipelineCard(id, config, role);
                        container.appendChild(card);
                    } else {
                        console.warn('Pipeline config not found for ID:', id);
                    }
                });

                feather.replace();
                console.log('Pipeline initialization complete'); // Debug log
            }

            function createPipelineCard(pipelineId, config, role) {
                const card = document.createElement('div');
                const isCurrentDefault = currentDefaultPipelineId === pipelineId;
                
                // Use CSS classes instead of dynamic Tailwind classes
                card.className = `pipeline-card border border-gray-200 rounded-lg p-4 hover:shadow-md transition-all cursor-pointer pipeline-${config.color} ${isCurrentDefault ? 'default-pipeline' : ''}`;
                card.onclick = () => selectPipeline(config.type, pipelineId);

                const statusBadge = isCurrentDefault ? 
                    `<span class="px-2 py-1 bg-blue-100 text-blue-700 text-xs font-medium rounded-full flex items-center">
                        <i data-feather="star" class="w-3 h-3 mr-1 fill-current"></i>Default
                    </span>` :
                    `<span class="badge px-2 py-1 text-xs font-medium rounded-full">${config.type.charAt(0).toUpperCase() + config.type.slice(1)}</span>`;

                card.innerHTML = `
                    <div class="flex items-start justify-between mb-3">
                        <div class="flex items-center space-x-3">
                            <div class="w-8 h-8 icon-bg rounded-lg flex items-center justify-center">
                                <i data-feather="${config.icon}" class="w-4 h-4 icon"></i>
                            </div>
                            <div>
                                <h4 class="font-semibold text-gray-900">${config.name}</h4>
                                <p class="text-xs text-gray-500">ID: ${pipelineId}</p>
                            </div>
                        </div>
                        ${statusBadge}
                    </div>
                    <p class="text-xs text-gray-600 mb-3">${config.description}</p>
                    <div class="space-y-3 text-sm">
                        <div class="flex justify-between">
                            <span class="text-gray-600">Latest Build:</span>
                            <span class="font-mono text-gray-900">${config.latestBuild}</span>
                        </div>
                        <div>
                            <div class="flex items-center justify-between mb-1">
                                <span class="text-gray-600">Drop URL:</span>
                                <button onclick="event.stopPropagation(); copyDropUrl('${config.dropUrl}')" 
                                        class="px-2 py-1 text-xs bg-gray-100 text-gray-600 rounded hover:bg-gray-200 transition-colors" 
                                        title="Copy Drop URL">
                                    <i data-feather="copy" class="w-3 h-3 inline mr-1"></i>Copy
                                </button>
                            </div>
                            <div class="bg-gray-50 rounded p-2">
                                <p class="font-mono text-xs text-gray-700 break-all">${config.dropUrl}</p>
                            </div>
                        </div>
                    </div>
                    <div class="mt-3 pt-3 border-t border-gray-100">
                        <div class="flex justify-center">
                            ${!isCurrentDefault ? `
                                <button class="px-4 py-2 bg-yellow-100 text-yellow-700 text-sm rounded-md hover:bg-yellow-200 transition-colors" onclick="event.stopPropagation(); showSetDefaultModal(${pipelineId}, '${config.name}')" title="Set as default pipeline">
                                    <i data-feather="star" class="w-3 h-3 inline mr-2"></i>Set as Default
                                </button>
                            ` : `
                                <span class="px-4 py-2 bg-blue-100 text-blue-700 text-sm rounded-md flex items-center" title="Current default pipeline">
                                    <i data-feather="star" class="w-3 h-3 inline mr-2 fill-current"></i>Default Pipeline
                                </span>
                            `}
                        </div>
                    </div>
                `;

                return card;
            }

            // New function to copy drop URL
            function copyDropUrl(dropUrl) {
                navigator.clipboard.writeText(dropUrl).then(() => {
                    showNotification('Drop URL Copied', 'Drop URL has been copied to clipboard');
                }).catch(err => {
                    // Fallback for older browsers
                    const textArea = document.createElement('textarea');
                    textArea.value = dropUrl;
                    document.body.appendChild(textArea);
                    textArea.select();
                    document.execCommand('copy');
                    document.body.removeChild(textArea);
                    showNotification('Drop URL Copied', 'Drop URL has been copied to clipboard');
                });
            }

            // Default pipeline management functions
            function showSetDefaultModal(pipelineId, pipelineName) {
                pendingDefaultPipelineId = pipelineId;
                document.getElementById('pipelineNameToSet').textContent = pipelineName;
                document.getElementById('setDefaultPipelineModal').classList.remove('hidden');
                feather.replace();
            }

            function closeSetDefaultModal() {
                pendingDefaultPipelineId = null;
                document.getElementById('setDefaultPipelineModal').classList.add('hidden');
            }

            function confirmSetDefault() {
                if (!pendingDefaultPipelineId) return;

                const oldDefaultId = currentDefaultPipelineId;
                currentDefaultPipelineId = pendingDefaultPipelineId;
                
                // Update service config
                const service = serviceConfig[currentService];
                service.DefaultPipelineId = currentDefaultPipelineId;
                
                // Update UI displays
                updateDefaultPipelineDisplay();
                updateQuickDeployOptions();
                updateAdvancedDeployModal();
                
                // Refresh pipeline cards to show new default
                initializePipelines();
                
                closeSetDefaultModal();
                
                const pipelineName = pipelineConfigs[currentDefaultPipelineId].name;
                showNotification('Default Pipeline Updated', `${pipelineName} is now the default pipeline`);
                
                // Update configuration editor with new default
                updateConfigEditor();
            }

            function updateDefaultPipelineDisplay() {
                const defaultConfig = pipelineConfigs[currentDefaultPipelineId];
                const display = document.getElementById('currentDefaultPipeline');
                if (defaultConfig && display) {
                    display.textContent = `${defaultConfig.name} (ID: ${currentDefaultPipelineId})`;
                }
            }

            function updateQuickDeployOptions() {
                const service = serviceConfig[currentService];
                if (!service) return;

                const pipelineSelect = document.getElementById('quickPipelineSelect');
                if (!pipelineSelect) return;
                
                pipelineSelect.innerHTML = '';

                // Add pipeline options, with default pipeline first
                const pipelineIds = [];
                if (service.PipelineId) pipelineIds.push({ id: service.PipelineId, role: 'primary' });
                if (service.IncrementalBuildPipelineId) pipelineIds.push({ id: service.IncrementalBuildPipelineId, role: 'incremental' });
                if (service.MainlineBuildPipelineId) pipelineIds.push({ id: service.MainlineBuildPipelineId, role: 'mainline' });

                // Sort so default pipeline appears first
                pipelineIds.sort((a, b) => {
                    if (a.id === currentDefaultPipelineId) return -1;
                    if (b.id === currentDefaultPipelineId) return 1;
                    return 0;
                });

                pipelineIds.forEach(({ id, role }) => {
                    const config = pipelineConfigs[id];
                    if (config) {
                        const option = document.createElement('option');
                        option.value = id;
                        const isDefault = id === currentDefaultPipelineId;
                        option.textContent = `${config.name}${isDefault ? ' (Default)' : ''} - ID: ${id}`;
                        if (isDefault) {
                            option.selected = true;
                        }
                        pipelineSelect.appendChild(option);
                    }
                });
            }

            function updateAdvancedDeployModal() {
                const service = serviceConfig[currentService];
                if (!service) return;

                const container = document.querySelector('#advancedDeployModal .grid');
                if (!container) return;

                container.innerHTML = '';

                const pipelineIds = [];
                if (service.PipelineId) pipelineIds.push({ id: service.PipelineId, role: 'primary' });
                if (service.IncrementalBuildPipelineId) pipelineIds.push({ id: service.IncrementalBuildPipelineId, role: 'incremental' });
                if (service.MainlineBuildPipelineId) pipelineIds.push({ id: service.MainlineBuildPipelineId, role: 'mainline' });

                // Sort so default pipeline appears first and is pre-selected
                pipelineIds.sort((a, b) => {
                    if (a.id === currentDefaultPipelineId) return -1;
                    if (b.id === currentDefaultPipelineId) return 1;
                    return 0;
                });

                pipelineIds.forEach(({ id, role }, index) => {
                    const config = pipelineConfigs[id];
                    if (config) {
                        const isDefault = id === currentDefaultPipelineId;
                        const label = document.createElement('label');
                        label.className = 'relative';
                        label.innerHTML = `
                            <input type="radio" name="deployPipeline" value="${id}" ${isDefault ? 'checked' : ''} class="sr-only">
                            <div class="pipeline-option p-4 border rounded-lg cursor-pointer hover:border-blue-300 transition-all ${isDefault ? 'border-blue-500 bg-blue-50' : ''}">
                                <div class="flex items-center space-x-3">
                                    <i data-feather="${config.icon}" class="w-5 h-5 text-${config.color}-600"></i>
                                    <div class="flex-1">
                                        <div class="flex items-center space-x-2">
                                            <p class="font-medium text-gray-900">${config.name}</p>
                                            ${isDefault ? '<i data-feather="star" class="w-4 h-4 text-blue-600 fill-current"></i>' : ''}
                                        </div>
                                        <p class="text-sm text-gray-500">${config.description}</p>
                                        <p class="text-xs text-gray-400 mt-1">Pipeline ID: ${id}${isDefault ? ' • Default' : ''}</p>
                                    </div>
                                </div>
                            </div>
                        `;
                        container.appendChild(label);
                    }
                });

                // Re-initialize radio button listeners
                document.querySelectorAll('input[name="deployPipeline"]').forEach(radio => {
                    radio.addEventListener('change', function() {
                        document.querySelectorAll('.pipeline-option').forEach(option => {
                            option.classList.remove('border-blue-500', 'bg-blue-50');
                        });
                        this.parentElement.querySelector('.pipeline-option').classList.add('border-blue-500', 'bg-blue-50');
                    });
                });

                feather.replace();
            }

            function updateConfigEditor() {
                const service = serviceConfig[currentService];
                if (!service) return;

                // Add DefaultPipelineId to the service config
                service.DefaultPipelineId = currentDefaultPipelineId;

                const configEditor = document.getElementById('configEditor');
                if (configEditor) {
                    configEditor.value = JSON.stringify(service, null, 2);
                }
            }

            // Pipeline action functions
            function selectPipeline(type, pipelineId) {
                const cards = document.querySelectorAll('.pipeline-card');
                cards.forEach(card => card.classList.remove('border-blue-500', 'bg-blue-50'));
                
                event.currentTarget.classList.add('border-blue-500', 'bg-blue-50');
                showNotification('Pipeline Selected', `${pipelineConfigs[pipelineId].name} (ID: ${pipelineId}) activated`);
            }

            // Notification system
            function showNotification(title, message) {
                // Create and show notification
                const notification = document.createElement('div');
                notification.className = 'fixed top-4 right-4 p-4 rounded-lg shadow-lg z-50 bg-blue-500 text-white';
                notification.innerHTML = `<strong>${title}</strong><br>${message}`;
                
                document.body.appendChild(notification);
                
                setTimeout(() => {
                    notification.remove();
                }, 3000);
            }

            // Initialize page
            document.addEventListener('DOMContentLoaded', function() {
                updateBuildVersions();
                
                document.getElementById('buildVersionSelect').addEventListener('change', updateDropUrl);

                // Add stagger animation for cards
                const cards = document.querySelectorAll('.card-hover');
                cards.forEach((card, index) => {
                    card.style.opacity = '0';
                    card.style.transform = 'translateY(20px)';
                    setTimeout(() => {
                        card.style.transition = 'all 0.6s ease';
                        card.style.opacity = '1';
                        card.style.transform = 'translateY(0)';
                    }, index * 100);
                });
            });

            // Configuration Editor Functions
            function showConfigEditor() {
                document.getElementById('configEditorModal').classList.remove('hidden');
                feather.replace();
            }

            function closeConfigEditor() {
                document.getElementById('configEditorModal').classList.add('hidden');
            }

            function validateConfig() {
                const configEditor = document.getElementById('configEditor');
                const statusElement = document.getElementById('configStatus');
                
                try {
                    JSON.parse(configEditor.value);
                    statusElement.innerHTML = `
                        <div class="w-2 h-2 bg-green-400 rounded-full"></div>
                        <span class="text-xs text-green-600">Valid</span>
                    `;
                    showNotification('Configuration Valid', 'JSON configuration is valid');
                } catch (error) {
                    statusElement.innerHTML = `
                        <div class="w-2 h-2 bg-red-400 rounded-full"></div>
                        <span class="text-xs text-red-600">Invalid</span>
                    `;
                    showNotification('Configuration Error', `Invalid JSON: ${error.message}`);
                }
            }

            function formatConfig() {
                const configEditor = document.getElementById('configEditor');
                try {
                    const parsed = JSON.parse(configEditor.value);
                    configEditor.value = JSON.stringify(parsed, null, 2);
                    showNotification('Format Applied', 'Configuration formatted successfully');
                } catch (error) {
                    showNotification('Format Error', 'Cannot format invalid JSON');
                }
            }

            function resetConfig() {
                const configEditor = document.getElementById('configEditor');
                configEditor.value = `{
  "BuildType": "RingPromotion",
  "PipelineId": 1418,
  "IncrementalBuildPipelineId": 33874,
  "RingPromotionRootPath": "autopilot",
  "BuildRoot": "https://outlookgriffinservice.blob.core.windows.net/owamailb2/prod_image.txt",
  "PpeVeName": "OwaMailB2-PPE",
  "BuildPathPattern": "VSO://https://outlookweb.artifacts.visualstudio.com/DefaultCollection/_apis/drop/drops/owamailb2_ms/<BuildVersion>?root=autopilot"
}`;
                validateConfig();
                showNotification('Configuration Reset', 'Configuration restored to original values');
            }

            function toggleDiffView() {
                const diffPanel = document.getElementById('configDiff');
                if (diffPanel.classList.contains('hidden')) {
                    diffPanel.classList.remove('hidden');
                    showNotification('Diff View', 'Showing configuration changes');
                } else {
                    diffPanel.classList.add('hidden');
                }
            }

            function saveConfiguration() {
                const createPR = document.getElementById('createPRConfig').checked;
                
                if (createPR) {
                    closeConfigEditor();
                    document.getElementById('prConfirmModal').classList.remove('hidden');
                } else {
                    // Direct save without PR
                    closeConfigEditor();
                    showNotification('Configuration Saved', 'Service configuration updated successfully');
                }
            }

            function exportConfig() {
                const config = {
                    "OwaMailB2": {
                        "BuildType": "RingPromotion",
                        "PipelineId": 1418,
                        "IncrementalBuildPipelineId": 33874,
                        "RingPromotionRootPath": "autopilot",
                        "BuildRoot": "https://outlookgriffinservice.blob.core.windows.net/owamailb2/prod_image.txt",
                        "PpeVeName": "OwaMailB2-PPE",
                        "BuildPathPattern": "VSO://https://outlookweb.artifacts.visualstudio.com/DefaultCollection/_apis/drop/drops/owamailb2_ms/<BuildVersion>?root=autopilot"
                    }
                };
                
                const blob = new Blob([JSON.stringify(config, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'owamailb2-config.json';
                a.click();
                URL.revokeObjectURL(url);
                
                showNotification('Export Complete', 'Configuration exported successfully');
            }

            // PR Modal Functions
            function closePRModal() {
                document.getElementById('prConfirmModal').classList.add('hidden');
            }

            function createPullRequest() {
                const title = document.getElementById('prTitle').value;
                const description = document.getElementById('prDescription').value;
                
                closePRModal();
                
                // Simulate PR creation
                showNotification('PR Created', 'Pull request created successfully');
                
                setTimeout(() => {
                    showNotification('PR Status', 'PR #1247: Ready for review');
                }, 2000);
            }

            // Auto-validate on editor input
            document.addEventListener('DOMContentLoaded', function() {
                const configEditor = document.getElementById('configEditor');
                if (configEditor) {
                    configEditor.addEventListener('input', function() {
                        // Debounced validation
                        clearTimeout(this.validationTimer);
                        this.validationTimer = setTimeout(validateConfig, 500);
                    });
                }
            });
        </script>
    </body>
</html>
