<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OwaMailB2 - Service Detail | Griffin PF Deployment AI</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/feather-icons"></script>
    <link rel="stylesheet" href="../../shared/fluent-ui.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap');
        body { font-family: 'Segoe UI', system-ui, -apple-system, sans-serif; }
        
        /* Fluent UI v9 Design System */
        :root {
            --colorNeutralForeground1: #242424;
            --colorNeutralForeground2: #424242;
            --colorNeutralForeground3: #616161;
            --colorNeutralBackground1: #ffffff;
            --colorNeutralBackground2: #f5f5f5;
            --colorNeutralBackground3: #f0f0f0;
            --colorBrandBackground: #0f6cbd;
            --colorBrandBackgroundHover: #115ea3;
            --colorBrandForeground1: #0f6cbd;
            --colorNeutralStroke1: #d1d1d1;
            --colorNeutralStroke2: #e0e0e0;
            --borderRadiusSmall: 4px;
            --borderRadiusMedium: 6px;
            --borderRadiusLarge: 8px;
            --shadow2: 0 1px 2px rgba(0,0,0,0.14), 0 0px 2px rgba(0,0,0,0.12);
            --shadow4: 0 2px 4px rgba(0,0,0,0.14), 0 0px 2px rgba(0,0,0,0.12);
        }
        
        .fluent-card {
            background: var(--colorNeutralBackground1);
            border: 1px solid var(--colorNeutralStroke2);
            border-radius: var(--borderRadiusLarge);
            box-shadow: var(--shadow2);
            transition: all 0.1s cubic-bezier(0.33, 0, 0.67, 1);
        }
        
        .fluent-card:hover {
            box-shadow: var(--shadow4);
            border-color: var(--colorNeutralStroke1);
        }
        
        .fluent-nav-item {
            padding: 6px 12px;
            border-radius: var(--borderRadiusSmall);
            color: var(--colorNeutralForeground2);
            text-decoration: none;
            font-weight: 500;
            transition: all 0.1s cubic-bezier(0.33, 0, 0.67, 1);
        }
        
        .fluent-nav-item:hover {
            background: var(--colorNeutralBackground3);
            color: var(--colorNeutralForeground1);
        }
        
        .fluent-nav-item.selected {
            background: #e3f2fd;
            color: var(--colorBrandForeground1);
            font-weight: 600;
        }
        
        .fluent-button {
            border-radius: var(--borderRadiusSmall);
            padding: 5px 12px;
            font-weight: 600;
            font-size: 14px;
            line-height: 20px;
            transition: all 0.1s cubic-bezier(0.33, 0, 0.67, 1);
            border: 1px solid transparent;
            cursor: pointer;
        }
        
        .fluent-button-primary {
            background: var(--colorBrandBackground);
            color: white;
        }
        
        .fluent-button-primary:hover {
            background: var(--colorBrandBackgroundHover);
        }
        
        .fluent-button-subtle {
            background: transparent;
            color: var(--colorNeutralForeground2);
            border: 1px solid var(--colorNeutralStroke1);
        }
        
        .fluent-button-subtle:hover {
            background: var(--colorNeutralBackground3);
            color: var(--colorNeutralForeground1);
        }
        
        .fluent-input, .fluent-select {
            padding: 6px 8px;
            border: 1px solid var(--colorNeutralStroke1);
            border-radius: var(--borderRadiusSmall);
            font-size: 14px;
            line-height: 20px;
            color: var(--colorNeutralForeground1);
            background: var(--colorNeutralBackground1);
            transition: all 0.1s cubic-bezier(0.33, 0, 0.67, 1);
        }
        
        .fluent-input:focus, .fluent-select:focus {
            outline: none;
            border-color: var(--colorBrandForeground1);
            box-shadow: 0 0 0 1px var(--colorBrandForeground1);
        }
        
        .fluent-text-title1 {
            font-size: 28px;
            font-weight: 600;
            line-height: 36px;
            color: var(--colorNeutralForeground1);
        }
        
        .fluent-text-title2 {
            font-size: 20px;
            font-weight: 600;
            line-height: 28px;
            color: var(--colorNeutralForeground1);
        }
        
        .fluent-text-body1 {
            font-size: 14px;
            font-weight: 400;
            line-height: 20px;
            color: var(--colorNeutralForeground2);
        }
        
        .fluent-badge {
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
            line-height: 16px;
        }
        
        .fluent-badge-neutral {
            background: var(--colorNeutralBackground3);
            color: var(--colorNeutralForeground2);
        }
        
        .fluent-badge-success {
            background: #dff6dd;
            color: #107c10;
        }
        
        .fluent-icon {
            width: 16px;
            height: 16px;
        }
        
        /* Pipeline card styles */
        .pipeline-card {
            transition: all 0.1s cubic-bezier(0.33, 0, 0.67, 1);
        }
        .pipeline-card:hover {
            box-shadow: var(--shadow4);
        }
        .pipeline-card.default-pipeline {
            border-color: var(--colorBrandForeground1);
            background-color: #e3f2fd;
        }
        
        /* Sidebar Styles */
        .sidebar {
            position: fixed;
            top: 0;
            left: 0;
            height: 100vh;
            width: 256px;
            background: var(--colorNeutralBackground1);
            border-right: 1px solid var(--colorNeutralStroke2);
            box-shadow: var(--shadow2);
            transform: translateX(-100%);
            transition: transform 0.3s cubic-bezier(0.33, 0, 0.67, 1);
            z-index: 1000;
            overflow-y: auto;
        }
        
        .sidebar.open {
            transform: translateX(0);
        }
        
        .sidebar-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(0, 0, 0, 0.4);
            z-index: 999;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s cubic-bezier(0.33, 0, 0.67, 1);
        }
        
        .sidebar-overlay.show {
            opacity: 1;
            visibility: visible;
        }
        
        .main-content {
            min-height: 100vh;
            transition: margin-left 0.3s cubic-bezier(0.33, 0, 0.67, 1);
        }
        
        .main-content.sidebar-open {
            margin-left: 256px;
        }
        
        .sidebar-nav-item {
            display: flex;
            align-items: center;
            padding: 8px 16px;
            color: var(--colorNeutralForeground2);
            text-decoration: none;
            border-radius: var(--borderRadiusSmall);
            margin: 2px 8px;
            transition: all 0.1s cubic-bezier(0.33, 0, 0.67, 1);
        }
        
        .sidebar-nav-item:hover {
            background: var(--colorNeutralBackground3);
            color: var(--colorNeutralForeground1);
        }
        
        .sidebar-nav-item.active {
            background: #e3f2fd;
            color: var(--colorBrandForeground1);
            font-weight: 600;
        }
        
        .sidebar-header {
            padding: 16px;
            border-bottom: 1px solid var(--colorNeutralStroke2);
        }
        
        .sidebar-section {
            padding: 16px 0;
            border-bottom: 1px solid var(--colorNeutralStroke2);
        }
        
        .sidebar-section-title {
            padding: 0 16px 8px 16px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--colorNeutralForeground3);
        }
        
        /* VE cards specific styles */
        .ve-card {
            cursor: pointer;
            transition: all 0.1s cubic-bezier(0.33,0,0.67,1);
        }
        .ve-card:hover {
            box-shadow: var(--shadow4);
            border-color: var(--colorNeutralStroke1);
        }
        .ve-badge {
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
            line-height: 16px;
        }
        .ve-badge-b-type {
            background: #e3f2fd;
            color: var(--colorBrandForeground1);
        }
        .ve-badge-b2-type {
            background: #dff6dd;
            color: #107c10;
        }
        
        /* Table styles similar to ve-detail */
        .config-actions { opacity: 0; transition: opacity 0.2s; }
        .table-row:hover .config-actions { opacity: 1; }
        .search-highlight { background: rgba(59, 130, 246, 0.1); border: 2px solid #3B82F6; }
        
        @media (min-width: 1024px) {
            .sidebar {
                position: fixed;
                transform: translateX(0);
                height: 100vh;
                top: 0;
            }
            
            .sidebar-overlay {
                display: none;
            }
            
            .main-content {
                margin-left: 256px;
            }
            
            .sidebar-toggle {
                display: none;
            }
        }
        
        @media (max-width: 1023px) {
            .main-content.sidebar-open {
                margin-left: 0;
            }
        }
    </style>
</head>
<body style="background: var(--colorNeutralBackground2); min-height: 100vh;">
    <!-- Sidebar Overlay -->
    <div class="sidebar-overlay" id="sidebarOverlay" onclick="toggleSidebar()"></div>
    
    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <div class="flex items-center space-x-3">
                <div class="w-8 h-8 rounded flex items-center justify-center" style="background: var(--colorBrandBackground);">
                    <i data-feather="layers" class="fluent-icon text-white"></i>
                </div>
                <div>
                    <h1 class="text-sm font-semibold" style="color: var(--colorNeutralForeground1);">Griffin PF AI</h1>
                    <p style="font-size: 10px; color: var(--colorNeutralForeground3);">Deployment Platform</p>
                </div>
            </div>
        </div>
        
        <nav class="sidebar-section">
            <div class="sidebar-section-title">Main Navigation</div>
            <a href="dashboard.html" class="sidebar-nav-item">
                <i data-feather="home" class="fluent-icon mr-3"></i>
                Dashboard
            </a>
            <a href="ve-management.html" class="sidebar-nav-item">
                <i data-feather="server" class="fluent-icon mr-3"></i>
                VE Management
            </a>
            <a href="services-management.html" class="sidebar-nav-item active">
                <i data-feather="layers" class="fluent-icon mr-3"></i>
                Services Management
            </a>
            <a href="deployment-history.html" class="sidebar-nav-item">
                <i data-feather="clock" class="fluent-icon mr-3"></i>
                History
            </a>
        </nav>
        
        <div class="sidebar-section">
            <div class="sidebar-section-title">Quick Access</div>
            <a href="ve-detail.html?ve=SovBase" class="sidebar-nav-item">
                <i data-feather="star" class="fluent-icon mr-3" style="color: #faa06b;"></i>
                SovBase
            </a>
            <a href="ve-detail.html?ve=ModelBSov" class="sidebar-nav-item">
                <i data-feather="star" class="fluent-icon mr-3" style="color: #faa06b;"></i>
                ModelBSov
            </a>
            <a href="ve-detail.html?ve=OwaMailB2-SOV" class="sidebar-nav-item">
                <i data-feather="star" class="fluent-icon mr-3" style="color: #faa06b;"></i>
                OwaMailB2-SOV
            </a>
        </div>
        
        <div class="sidebar-section">
            <div class="sidebar-section-title">Account</div>
            <a href="login.html" class="sidebar-nav-item">
                <i data-feather="log-out" class="fluent-icon mr-3"></i>
                Logout
            </a>
        </div>
    </aside>

    <!-- Main Content -->
    <div class="main-content" id="mainContent">
        <!-- Fluent Navigation -->
        <nav class="fluent-card" style="margin: 0; border-radius: 0; border-left: none; border-right: none; border-top: none;">
            <div class="container mx-auto px-6">
                <div class="flex justify-between items-center py-4">
                    <div class="flex items-center space-x-4">
                        <button class="sidebar-toggle lg:hidden fluent-button fluent-button-subtle p-2" onclick="toggleSidebar()">
                            <i data-feather="menu" class="fluent-icon"></i>
                        </button>
                        <div class="flex items-center space-x-3">
                            <div>
                                <h1 class="text-lg font-semibold" style="color: var(--colorNeutralForeground1);">Service Detail</h1>
                                <p class="fluent-text-caption1">Cross Virtual Environment Service Management</p>
                            </div>
                        </div>
                    </div>
                    <div class="flex items-center space-x-3">
                        <div class="w-8 h-8 rounded-full flex items-center justify-center" style="background: var(--colorNeutralBackground3);">
                            <i data-feather="user" class="fluent-icon" style="color: var(--colorNeutralForeground3);"></i>
                        </div>
                        <span class="text-sm" style="color: var(--colorNeutralForeground2);">John Doe</span>
                    </div>
                </div>
            </div>
        </nav>

        <div class="container mx-auto px-6 py-8">
            <!-- Breadcrumb -->
            <nav class="flex items-center space-x-2 text-sm mb-6" style="color: var(--colorNeutralForeground3);">
                <a href="services-management.html" class="hover:text-blue-600 transition-colors" style="color: var(--colorBrandForeground1);">Services Management</a>
                <i data-feather="chevron-right" class="w-4 h-4"></i>
                <span style="color: var(--colorNeutralForeground1); font-weight: 500;" id="serviceName">OwaMailB2</span>
            </nav>

            <!-- Service Header -->
            <div class="fluent-card mb-8">
                <div class="p-8">
                    <div class="flex items-center justify-between mb-6">
                        <div class="flex items-center space-x-4">
                            <div class="w-16 h-16 rounded-xl flex items-center justify-center" id="serviceIcon" style="background: #dff6dd;">
                                <i data-feather="mail" class="w-8 h-8" style="color: #107c10;"></i>
                            </div>
                            <div>
                                <div class="flex items-center space-x-3 mb-1">
                                    <h1 class="fluent-text-title1" id="serviceTitle">OwaMailB2</h1>
                                    <button id="favoriteBtn" onclick="toggleFavorite()" style="color: #faa06b; transition: opacity 0.1s;" class="hover:opacity-80" title="Add to favorites">
                                        <i data-feather="star" class="w-6 h-6"></i>
                                    </button>
                                </div>
                                <p class="fluent-text-body1 mt-1" id="serviceDescription">Outlook Web App Mail Backend Service</p>
                                <div class="flex items-center space-x-4 mt-3">
                                    <span class="fluent-badge fluent-badge-success" id="serviceType">Exchange Service</span>
                                    <span class="text-sm" style="color: var(--colorNeutralForeground3);">Last updated: 2 hours ago</span>
                                </div>
                            </div>
                        </div>
                        <div class="flex items-center space-x-3">
                            <button onclick="refreshData()" class="fluent-button fluent-button-subtle" title="Refresh data">
                                <i data-feather="refresh-cw" class="fluent-icon inline mr-2"></i>Refresh
                            </button>
                            <button onclick="bulkDeploy()" class="fluent-button fluent-button-primary">
                                <i data-feather="upload" class="fluent-icon inline mr-2"></i>Deploy to All VEs
                            </button>
                        </div>
                    </div>
                    
                    <!-- Service Stats Grid -->
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
                        <div class="text-center p-4 rounded-lg border transition-all" style="border-color: var(--colorNeutralStroke2); background: var(--colorNeutralBackground2);">
                            <p class="text-3xl font-bold mb-2" style="color: var(--colorBrandForeground1);" id="totalVEs">2</p>
                            <p class="text-sm" style="color: var(--colorNeutralForeground2);">Total VE Instances</p>
                        </div>
                        <div class="text-center p-4 rounded-lg border transition-all" style="border-color: var(--colorNeutralStroke2); background: var(--colorNeutralBackground2);">
                            <p class="text-3xl font-bold mb-2" style="color: #107c10;" id="deployedVEs">2</p>
                            <p class="text-sm" style="color: var(--colorNeutralForeground2);">Deployed VEs</p>
                        </div>
                        <div class="text-center p-4 rounded-lg border transition-all" style="border-color: var(--colorNeutralStroke2); background: var(--colorNeutralBackground2);">
                            <p class="text-3xl font-bold mb-2" style="color: #ca5010;" id="pendingVEs">0</p>
                            <p class="text-sm" style="color: var(--colorNeutralForeground2);">Pending Deployment</p>
                        </div>
                        <div class="text-center p-4 rounded-lg border transition-all" style="border-color: var(--colorNeutralStroke2); background: var(--colorNeutralBackground2);">
                            <p class="text-3xl font-bold mb-2" style="color: var(--colorBrandForeground1);" id="latestVersion">v2.1.234</p>
                            <p class="text-sm" style="color: var(--colorNeutralForeground2);">Latest Version</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Search and Filters -->
            <div class="fluent-card mb-8">
                <div class="p-6">
                    <div class="flex flex-col lg:flex-row lg:items-center justify-between space-y-4 lg:space-y-0">
                        <div class="flex flex-col md:flex-row md:items-center space-y-4 md:space-y-0 md:space-x-4">
                            <div class="relative">
                                <i data-feather="search" class="fluent-icon absolute left-2 top-1/2 transform -translate-y-1/2" style="color: var(--colorNeutralForeground3);"></i>
                                <input type="text" 
                                       id="searchInput"
                                       placeholder="Search by VE name..." 
                                       class="fluent-input with-icon w-80"
                                       oninput="performSearch()">
                            </div>
                            <select id="veTypeFilter" class="fluent-select" onchange="applyFilters()">
                                <option value="">All VE Types</option>
                                <option value="B Type">B Type VE</option>
                                <option value="B2 Type">B2 Type VE</option>
                            </select>
                            <select id="statusFilter" class="fluent-select" onchange="applyFilters()">
                                <option value="">All Deployment Status</option>
                                <option value="deployed">Deployed</option>
                                <option value="not-deployed">Not Deployed</option>
                                <option value="pending">Pending</option>
                            </select>
                            <button onclick="clearSearch()" class="fluent-button fluent-button-subtle">
                                Clear All
                            </button>
                        </div>
                        <div class="flex items-center space-x-3">
                            <button id="bulkDeployBtn" onclick="showBulkDeployModal()" 
                                    class="fluent-button fluent-button-primary disabled:opacity-50 disabled:cursor-not-allowed" 
                                    disabled>
                                <i data-feather="upload" class="fluent-icon inline mr-2"></i>Deploy to Selected VEs
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- VE Table -->
            <div class="fluent-card">
                <div class="p-6" style="border-bottom: 1px solid var(--colorNeutralStroke2);">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center space-x-4">
                            <h2 class="fluent-text-title2">Virtual Environments using this Service</h2>
                            <span id="selectedCount" class="hidden fluent-badge" style="background: #e3f2fd; color: var(--colorBrandForeground1);">0 selected</span>
                        </div>
                        <span class="fluent-badge fluent-badge-info" id="veCount">2 VEs</span>
                    </div>
                </div>

                <div class="overflow-x-auto">
                    <table class="min-w-full" id="veTable">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-4 text-left w-12">
                                    <input type="checkbox" id="selectAll" onchange="toggleSelectAll()" class="rounded border-gray-300">
                                </th>
                                <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100" onclick="sortTable('name')">
                                    <div class="flex items-center">
                                        VE Name
                                        <i data-feather="arrow-up-down" class="w-3 h-3 ml-1 opacity-50"></i>
                                    </div>
                                </th>
                                <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Type</th>
                                <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Service Status</th>
                                <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Current Version</th>
                                <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Last Deploy</th>
                                <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                            </tr>
                        </thead>
                        <tbody class="bg-white divide-y divide-gray-200" id="veTableBody">
                            <!-- VE rows will be dynamically populated -->
                        </tbody>
                    </table>
                </div>

                <!-- Table Footer with Pagination -->
                <div class="px-6 py-4 border-t border-gray-100">
                    <div class="flex flex-col md:flex-row items-center justify-between space-y-4 md:space-y-0">
                        <div class="flex items-center space-x-4">
                            <span class="text-sm text-gray-500" id="tableInfo">Showing 2 VEs</span>
                            <div id="activeFilters" class="flex items-center space-x-2"></div>
                        </div>
                        <div class="flex items-center space-x-2">
                            <select id="pageSize" class="px-3 py-1 border border-gray-300 rounded text-sm">
                                <option value="10">10 per page</option>
                                <option value="25">25 per page</option>
                                <option value="50">50 per page</option>
                            </select>
                            <nav class="flex space-x-1" id="pagination">
                                <button class="fluent-button fluent-button-subtle px-3 py-2" style="color: var(--colorNeutralForeground3);">
                                    <i data-feather="chevron-left" class="fluent-icon"></i>
                                </button>
                                <button class="fluent-button fluent-button-primary px-3 py-2 text-sm">1</button>
                                <button class="fluent-button fluent-button-subtle px-3 py-2">
                                    <i data-feather="chevron-right" class="fluent-icon"></i>
                                </button>
                            </nav>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Bulk Deploy Modal -->
            <div id="bulkDeployModal" class="hidden fixed inset-0 bg-gray-900 bg-opacity-50 flex items-center justify-center z-50">
                <div class="bg-white rounded-xl shadow-xl max-w-md w-full mx-4">
                    <div class="p-6">
                        <div class="flex items-center mb-4">
                            <i data-feather="upload" class="w-6 h-6 text-blue-600 mr-3"></i>
                            <h3 class="text-lg font-semibold text-gray-900">Deploy to Selected VEs</h3>
                        </div>
                        <p class="text-gray-600 mb-4">Are you sure you want to deploy <span class="font-semibold" id="serviceTitleForModal">OwaMailB2</span> to <span id="deployVECount" class="font-semibold">0</span> selected VE(s)?</p>
                        <div class="bg-blue-50 rounded-lg p-4 mb-4">
                            <h4 class="text-sm font-medium text-blue-900 mb-2">Selected VEs:</h4>
                            <ul id="deployVEsList" class="text-sm text-blue-800 space-y-1"></ul>
                        </div>
                    </div>
                    <div class="px-6 py-4 border-t border-gray-100 flex justify-end space-x-3">
                        <button onclick="hideBulkDeployModal()" class="px-4 py-2 text-gray-600 hover:text-gray-800 transition-colors">Cancel</button>
                        <button onclick="confirmBulkDeploy()" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                            <i data-feather="upload" class="w-4 h-4 inline mr-2"></i>Deploy Now
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        feather.replace();
        
        // Service data structure with VEs
        const serviceData = {
            'OwaMailB2': {
                name: 'OwaMailB2',
                description: 'Outlook Web App Mail Backend Service',
                type: 'Exchange Service',
                icon: 'mail',
                iconColor: '#107c10',
                iconBg: '#dff6dd',
                latestVersion: 'v2.1.234',
                ves: [
                    {
                        id: 'sovbase',
                        name: 'SovBase',
                        type: 'B Type',
                        status: 'deployed',
                        version: 'v2.1.234',
                        lastDeploy: '2 hours ago',
                        icon: 'server',
                        iconBg: 'linear-gradient(135deg, #0f6cbd 0%, #115ea3 100%)',
                        canDeploy: true
                    },
                    {
                        id: 'owamailb2-sov',
                        name: 'OwaMailB2-SOV',
                        type: 'B2 Type',
                        status: 'deployed',
                        version: 'v2.1.234',
                        lastDeploy: '1 hour ago',
                        icon: 'mail',
                        iconBg: 'linear-gradient(135deg, #107c10 0%, #0b5c0a 100%)',
                        canDeploy: true
                    }
                ]
            }
        };

        // Global state
        const appState = {
            currentService: null,
            filteredVEs: [],
            selectedVEs: new Set()
        };

        // Initialize page
        function initializePage() {
            const serviceName = getServiceFromURL();
            const service = serviceData[serviceName];
            
            if (!service) {
                console.error('Service not found:', serviceName);
                return;
            }
            
            appState.currentService = service;
            appState.filteredVEs = [...service.ves];
            
            updateServiceHeader(service);
            renderVETable();
            updateUI();
            
            feather.replace();
        }

        function updateServiceHeader(service) {
            // ...existing service header update code...
            document.getElementById('serviceName').textContent = service.name;
            document.getElementById('serviceTitle').textContent = service.name;
            document.getElementById('serviceDescription').textContent = service.description;
            document.getElementById('serviceType').textContent = service.type;
            document.getElementById('latestVersion').textContent = service.latestVersion;
            document.getElementById('serviceTitleForModal').textContent = service.name;
            
            // Update stats
            const totalVEs = service.ves.length;
            const deployedVEs = service.ves.filter(ve => ve.status === 'deployed').length;
            const pendingVEs = service.ves.filter(ve => ve.status === 'pending').length;
            
            document.getElementById('totalVEs').textContent = totalVEs;
            document.getElementById('deployedVEs').textContent = deployedVEs;
            document.getElementById('pendingVEs').textContent = pendingVEs;
            document.getElementById('veCount').textContent = `${totalVEs} VEs`;
        }

        function renderVETable() {
            const tbody = document.getElementById('veTableBody');
            tbody.innerHTML = '';

            appState.filteredVEs.forEach(ve => {
                const row = createVERow(ve);
                tbody.appendChild(row);
            });

            updateTableInfo();
            feather.replace();
        }

        function createVERow(ve) {
            const row = document.createElement('tr');
            row.className = 'table-row hover:bg-gray-50 transition-colors';
            row.dataset.veId = ve.id;
            
            const statusConfig = getVEStatusConfig(ve.status);
            
            row.innerHTML = `
                <td class="px-6 py-4">
                    <input type="checkbox" ${ve.canDeploy ? '' : 'disabled'} 
                           onchange="toggleVESelection('${ve.id}')" 
                           class="rounded border-gray-300 ve-checkbox" data-ve-id="${ve.id}">
                </td>
                <td class="px-6 py-4">
                    <div class="flex items-center space-x-3">
                        <div class="w-8 h-8 rounded-lg flex items-center justify-center" style="background: ${ve.type === 'B Type' ? '#e3f2fd' : '#dff6dd'};">
                            <i data-feather="${ve.icon}" class="w-4 h-4" style="color: ${ve.type === 'B Type' ? 'var(--colorBrandForeground1)' : '#107c10'};"></i>
                        </div>
                        <div>
                            <a href="ve-service-detail.html?ve=${ve.name}&service=${appState.currentService.name}" 
                               class="text-gray-900 font-medium hover:text-blue-600 transition-colors">${ve.name}</a>
                            <p class="text-sm text-gray-500">${ve.type} Virtual Environment</p>
                        </div>
                    </div>
                </td>
                <td class="px-6 py-4">
                    <span class="ve-badge ${ve.type === 'B Type' ? 've-badge-b-type' : 've-badge-b2-type'}">${ve.type}</span>
                </td>
                <td class="px-6 py-4">${statusConfig.badge}</td>
                <td class="px-6 py-4 font-mono text-sm ${ve.version ? 'text-gray-900' : 'text-gray-400'}">
                    ${ve.version || 'null'}
                </td>
                <td class="px-6 py-4 text-sm text-gray-500">
                    ${ve.lastDeploy}
                </td>
                <td class="px-6 py-4">
                    <div class="config-actions">${createVEActionButtons(ve)}</div>
                </td>
            `;

            return row;
        }

        function getVEStatusConfig(status) {
            const configs = {
                'deployed': {
                    badge: '<span class="px-2 py-1 bg-green-100 text-green-800 text-xs font-medium rounded-full">Deployed</span>'
                },
                'not-deployed': {
                    badge: '<span class="px-2 py-1 bg-gray-100 text-gray-800 text-xs font-medium rounded-full">Not Deployed</span>'
                },
                'pending': {
                    badge: '<span class="px-2 py-1 bg-yellow-100 text-yellow-800 text-xs font-medium rounded-full">Pending</span>'
                }
            };
            return configs[status] || configs['not-deployed'];
        }

        function createVEActionButtons(ve) {
            if (ve.status === 'deployed') {
                return `
                    <div class="flex space-x-2">
                        <button onclick="redeployToVE('${ve.id}')" class="px-3 py-1.5 bg-blue-600 text-white text-sm rounded-lg hover:bg-blue-700 transition-colors">
                            <i data-feather="refresh-cw" class="w-3 h-3 inline mr-1"></i>Redeploy
                        </button>
                    </div>
                `;
            } else if (ve.status === 'not-deployed') {
                return `
                    <div class="flex space-x-2">
                        <button onclick="deployToVE('${ve.id}')" class="px-3 py-1.5 bg-green-600 text-white text-sm rounded-lg hover:bg-green-700 transition-colors">
                            <i data-feather="upload" class="w-3 h-3 inline mr-1"></i>Deploy
                        </button>
                    </div>
                `;
            }
            return '';
        }

        // Selection management similar to ve-detail
        function toggleSelectAll() {
            const selectAll = document.getElementById('selectAll');
            const checkboxes = document.querySelectorAll('.ve-checkbox:not(:disabled)');
            
            checkboxes.forEach(checkbox => {
                checkbox.checked = selectAll.checked;
                const veId = checkbox.dataset.veId;
                if (selectAll.checked) {
                    appState.selectedVEs.add(veId);
                } else {
                    appState.selectedVEs.delete(veId);
                }
            });

            updateSelectionUI();
        }

        function toggleVESelection(veId) {
            if (appState.selectedVEs.has(veId)) {
                appState.selectedVEs.delete(veId);
            } else {
                appState.selectedVEs.add(veId);
            }
            updateSelectionUI();
        }

        function updateSelectionUI() {
            const count = appState.selectedVEs.size;
            const selectedCount = document.getElementById('selectedCount');
            const bulkDeployBtn = document.getElementById('bulkDeployBtn');

            if (count > 0) {
                selectedCount.classList.remove('hidden');
                selectedCount.textContent = `${count} selected`;
                bulkDeployBtn.disabled = false;
            } else {
                selectedCount.classList.add('hidden');
                bulkDeployBtn.disabled = true;
            }
        }

        // Modal management
        function showBulkDeployModal() {
            const selectedVEs = Array.from(appState.selectedVEs).map(id => 
                appState.currentService.ves.find(ve => ve.id === id)
            );

            document.getElementById('deployVECount').textContent = selectedVEs.length;
            const vesList = document.getElementById('deployVEsList');
            vesList.innerHTML = selectedVEs.map(ve => 
                `<li class="flex items-center space-x-2">
                    <i data-feather="${ve.icon}" class="w-3 h-3"></i>
                    <span>${ve.name}</span>
                </li>`
            ).join('');

            document.getElementById('bulkDeployModal').classList.remove('hidden');
            feather.replace();
        }

        function hideBulkDeployModal() {
            document.getElementById('bulkDeployModal').classList.add('hidden');
        }

        function confirmBulkDeploy() {
            const selectedVENames = Array.from(appState.selectedVEs).map(id => 
                appState.currentService.ves.find(ve => ve.id === id).name
            );
            
            showNotification('Bulk Deploy Started', `Deploying ${appState.currentService.name} to ${selectedVENames.length} VEs...`);
            hideBulkDeployModal();
            
            // Clear selections
            appState.selectedVEs.clear();
            document.querySelectorAll('.ve-checkbox').forEach(cb => cb.checked = false);
            document.getElementById('selectAll').checked = false;
            updateSelectionUI();
        }

        // Filter and search functions
        function performSearch() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase().trim();
            
            if (!searchTerm) {
                applyFilters();
                return;
            }

            appState.filteredVEs = appState.currentService.ves.filter(ve => 
                ve.name.toLowerCase().includes(searchTerm) ||
                ve.type.toLowerCase().includes(searchTerm)
            );

            renderVETable();
            updateActiveFilters();
        }

        function applyFilters() {
            const typeFilter = document.getElementById('veTypeFilter').value;
            const statusFilter = document.getElementById('statusFilter').value;

            appState.filteredVEs = appState.currentService.ves.filter(ve => {
                let matchesType = !typeFilter || ve.type === typeFilter;
                let matchesStatus = !statusFilter || ve.status === statusFilter;
                
                return matchesType && matchesStatus;
            });

            renderVETable();
            updateActiveFilters();
        }

        function clearSearch() {
            document.getElementById('searchInput').value = '';
            document.getElementById('veTypeFilter').value = '';
            document.getElementById('statusFilter').value = '';
            appState.filteredVEs = [...appState.currentService.ves];
            renderVETable();
            updateActiveFilters();
        }

        function updateActiveFilters() {
            const container = document.getElementById('activeFilters');
            container.innerHTML = '';

            const searchQuery = document.getElementById('searchInput').value;
            const typeFilter = document.getElementById('veTypeFilter').value;
            const statusFilter = document.getElementById('statusFilter').value;

            if (searchQuery) {
                container.appendChild(createFilterTag('Search', searchQuery));
            }
            if (typeFilter) {
                container.appendChild(createFilterTag('Type', typeFilter));
            }
            if (statusFilter) {
                container.appendChild(createFilterTag('Status', statusFilter));
            }
        }

        function createFilterTag(label, value) {
            const tag = document.createElement('span');
            tag.className = 'inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800';
            tag.innerHTML = `${label}: ${value} <button onclick="this.parentElement.remove()" class="ml-1 text-blue-600 hover:text-blue-800"><i data-feather="x" class="w-3 h-3"></i></button>`;
            return tag;
        }

        function updateTableInfo() {
            const total = appState.currentService.ves.length;
            const filtered = appState.filteredVEs.length;
            const info = document.getElementById('tableInfo');
            
            if (filtered === total) {
                info.textContent = `Showing ${filtered} VE${filtered !== 1 ? 's' : ''}`;
            } else {
                info.textContent = `Showing ${filtered} of ${total} VEs`;
            }
        }

        function updateUI() {
            updateTableInfo();
            updateSelectionUI();
            updateActiveFilters();
        }

        // Action handlers
        function deployToVE(veId) {
            const ve = appState.currentService.ves.find(v => v.id === veId);
            showNotification('Deploy Started', `Deploying ${appState.currentService.name} to ${ve.name}...`);
        }

        function redeployToVE(veId) {
            const ve = appState.currentService.ves.find(v => v.id === veId);
            showNotification('Redeploy Started', `Redeploying ${appState.currentService.name} to ${ve.name}...`);
        }

        // Utility functions
        function getServiceFromURL() {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get('service') || 'OwaMailB2';
        }

        function showNotification(title, message) {
            const notification = document.createElement('div');
            notification.className = 'fixed top-4 right-4 p-4 rounded-lg shadow-lg z-50 bg-blue-500 text-white max-w-sm';
            notification.innerHTML = `<strong>${title}</strong><br>${message}`;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        // Unified sidebar functionality
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('sidebarOverlay');
            
            sidebar.classList.toggle('open');
            overlay.classList.toggle('show');
        }
        
        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            initializePage();
            
            if (window.innerWidth >= 1024) {
                const sidebar = document.getElementById('sidebar');
                sidebar.classList.add('open');
            }
        });
        
        // Handle window resize
        window.addEventListener('resize', function() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('sidebarOverlay');
            
            if (window.innerWidth >= 1024) {
                sidebar.classList.add('open');
                overlay.classList.remove('show');
            } else {
                sidebar.classList.remove('open');
                overlay.classList.remove('show');
            }
        });
    </script>
</body>
</html>