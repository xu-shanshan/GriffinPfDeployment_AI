<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Griffin PF Deployment AI</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/feather-icons"></script>
    <link rel="stylesheet" href="./shared/fluent-ui.css">
    <link rel="stylesheet" href="./shared/common.css">
</head>
<body>
    <a href="#mainContent" class="visually-hidden" aria-label="Skip to main content">Skip to main content</a>
    <div id="app-sidebar"></div>

    <!-- Main Content -->
    <main class="main-content" id="mainContent" role="main" aria-label="Dashboard main content">
        <div id="app-header"></div>
        <div class="web-container content-area">
            <!-- Welcome Section -->
            <section class="welcome-section section-spacing">
                <h2 class="fluent-text-title1 mb-3">Good morning, John</h2>
                <p class="fluent-text-body1">Here's what's happening with your virtual environments today.</p>
            </section>

            <!-- Stats Cards -->
            <section class="stats-section section-spacing" aria-label="System statistics">
                <div id="statsCards" class="stats-grid"></div>
            </section>

            <!-- Favorites Grid -->
            <section class="favorites-grid">
                <div class="favorites-grid-wrap">
                    <!-- Favorite VEs Section -->
                    <article class="favorites-card">
                        <header class="favorites-header">
                            <div class="favorites-title">
                                <i data-feather="star" class="star-icon" aria-hidden="true"></i>
                                <h3 class="fluent-text-title2">Favorite Virtual Environments</h3>
                            </div>
                            <button class="fluent-button fluent-button-subtle" data-navigate="ve-management.html">View All</button>
                        </header>
                        
                        <div class="favorites-content">
                            <div id="favoriteVEs" class="favorites-list"></div>
                        </div>
                    </article>

                    <!-- Favorite Services Section -->
                    <article class="favorites-card">
                        <header class="favorites-header">
                            <div class="favorites-title">
                                <i data-feather="heart" class="heart-icon" aria-hidden="true"></i>
                                <h3 class="fluent-text-title2">Favorite Services</h3>
                            </div>
                            <button class="fluent-button fluent-button-subtle" data-navigate="services-management.html">View All</button>
                        </header>
                        
                        <div class="favorites-content">
                            <div id="favoriteServices" class="favorites-list"></div>
                        </div>
                    </article>
                </div>
            </section>
        </div>
    </main>

    <script>
    // Mock data JSON
    const mockData = {
        stats: [
            { icon:'database', color:'blue', number:18, label:'Total VEs', badge:{text:'+2 this month', type:'success'}, footerIcon:'trending-up', navigate:'ve-management.html' },
            { icon:'layers', color:'green', number:156, label:'Active Services', badge:{text:'98.7% uptime', type:'success'}, status:'active', navigate:'services-management.html' },
            { icon:'upload-cloud', color:'orange', number:23, label:'Recent Deployments', badge:{text:'Last 24 hours', type:'info'}, footerIcon:'clock', navigate:'deployment-history.html' }
        ],
        favoriteVEs: [
            { name:'SovBase', services:67, type:'B Type', typeClass:'neutral', updated:'2 hours ago' },
            { name:'ModelBSov', services:65, type:'B Type', typeClass:'neutral', updated:'4 hours ago' },
            { name:'OwaMailB2-SOV', services:1, type:'B2 Type', typeClass:'success', updated:'2 minutes ago' }
        ],
        favoriteServices: [
            { name:'OwaMailB2', instances:2, status:'Active', statusClass:'success', updated:'1 hour ago' },
            { name:'Exchange', instances:2, status:'Active', statusClass:'success', updated:'3 hours ago' },
            { name:'GraphConnectors', instances:2, status:'Not Deployed', statusClass:'neutral', updated:'6 hours ago' }
        ]
    };

    function el(tag, cls='', html='') {
        const e = document.createElement(tag);
        if (cls) e.className = cls;
        if (html) e.innerHTML = html;
        return e;
    }

    function renderStats() {
        const wrap = document.getElementById('statsCards');
        mockData.stats.forEach(s => {
            const a = el('article','stat-card');
            a.dataset.navigate = s.navigate;
            a.innerHTML = `
                <div class="stat-card-header">
                    <div class="stat-icon stat-icon-${s.color}">
                        <i data-feather="${s.icon}" aria-hidden="true"></i>
                    </div>
                    <div class="stat-content">
                        <div class="stat-number">${s.number}</div>
                        <div class="fluent-text-body1">${s.label}</div>
                    </div>
                </div>
                <hr class="stat-divider">
                <div class="stat-footer">
                    <span class="fluent-badge fluent-badge-${s.badge.type}">${s.badge.text}</span>
                    ${s.status ? '<div class="status-indicator status-active"></div>' : (s.footerIcon ? `<i data-feather="${s.footerIcon}" class="trend-icon" aria-hidden="true"></i>`:'')}
                </div>`;
            wrap.appendChild(a);
        });
    }

    function renderFavoritesVE() {
        const wrap = document.getElementById('favoriteVEs');
        mockData.favoriteVEs.forEach(v => {
            const d = el('div','favorite-item');
            d.dataset.navigate = `ve-detail.html?ve=${encodeURIComponent(v.name)}`;
            d.innerHTML = `
                <div class="favorite-item-content">
                    <div class="favorite-details">
                        <h4 class="favorite-name">${v.name}</h4>
                        <div class="favorite-meta">
                            <span class="fluent-text-body1">${v.services} services</span>
                            <span class="fluent-badge fluent-badge-${v.typeClass}">${v.type}</span>
                        </div>
                    </div>
                </div>
                <div class="favorite-timestamp">
                    <span>${v.updated}</span>
                    <i data-feather="chevron-right" class="fluent-icon" aria-hidden="true"></i>
                </div>`;
            wrap.appendChild(d);
        });
    }

    function renderFavoritesServices() {
        const wrap = document.getElementById('favoriteServices');
        mockData.favoriteServices.forEach(s => {
            const d = el('div','favorite-item');
            d.dataset.navigate = `service-detail.html?service=${encodeURIComponent(s.name)}`;
            d.innerHTML = `
                <div class="favorite-item-content">
                    <div class="favorite-details">
                        <h4 class="favorite-name">${s.name}</h4>
                        <div class="favorite-meta">
                            <span class="fluent-text-body1">${s.instances} VE instances</span>
                            <span class="fluent-badge fluent-badge-${s.statusClass}">${s.status}</span>
                        </div>
                    </div>
                </div>
                <div class="favorite-timestamp">
                    <span>${s.updated}</span>
                    <i data-feather="chevron-right" class="fluent-icon" aria-hidden="true"></i>
                </div>`;
            wrap.appendChild(d);
        });
    }

    function enableNavigation() {
        document.body.addEventListener('click', e => {
            const t = e.target.closest('[data-navigate]');
            if (t) location.href = t.dataset.navigate;
        });
    }

    // Added animation (migrated from deprecated dashboard.js)
    function animateNumbers() {
        document.querySelectorAll('#statsCards .stat-card .stat-number').forEach(el => {
            const target = parseInt(el.textContent, 10) || 0;
            el.textContent = '0';
            const start = performance.now();
            const duration = 800;
            function step(now) {
                const p = Math.min((now - start) / duration, 1);
                el.textContent = Math.round(target * p);
                if (p < 1) requestAnimationFrame(step);
            }
            requestAnimationFrame(step);
        });
    }

    document.addEventListener('DOMContentLoaded', () => {
        renderStats();
        renderFavoritesVE();
        renderFavoritesServices();
        enableNavigation();
        animateNumbers();
        // use centralized icon refresh
        if (window.refreshFeatherIcons) window.refreshFeatherIcons();
    });
    </script>
    <script>
        // Provide sidebar context & favorites before loading sidebar.js
        window.SIDEBAR_ACTIVE = 'dashboard';
        window.SIDEBAR_FAVORITES = (mockData.favoriteVEs || []).map(v => ({ name: v.name, type:'ve' }));
    </script>
    <script src="./shared/sidebar.js"></script>
    <script src="./shared/header.js"></script>
    <script>
      initHeader({ title:'Dashboard', subtitle:'Virtual Environment Management', user:{ name:'John Doe' } });
    </script>
</body>
</html>