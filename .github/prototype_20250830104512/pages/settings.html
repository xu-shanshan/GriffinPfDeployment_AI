<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Settings - Griffin Deployment Prototype</title>
<link rel="stylesheet" href="../shared/common.css" />
<script src="../shared/common.js"></script>
<script src="../shared/mock-data.js"></script>
<script src="../shared/Layout/header.js"></script>
<script src="../shared/Layout/footer.js"></script>
<script src="../shared/Layout/sidebar.js"></script>
<script src="../shared/commonComponent/card.js"></script>
<script src="../shared/commonComponent/modal.js"></script>
</head>
<body>
<div class="layout" id="app"></div>
<script>
(function(G){
  const root = G.qs('#app');
  root.appendChild(G.Layout.renderSidebar('settings'));
  root.appendChild(G.Layout.renderHeader());
  const main = document.createElement('main');
  main.className='layout-main';
  root.appendChild(main);
  root.appendChild(G.Layout.renderFooter());

  function render(){
    main.innerHTML = `
      <h1>Settings</h1>
      <div class="grid cols-3">
        <div class="card">
          <div class="card-header"><span>User</span></div>
          <div class="card-body">
            <div>Name: <strong>${G.state.currentUser.name}</strong></div>
            <div>Roles: <strong data-roles>${G.state.currentUser.roles.join(', ')}</strong></div>
            <div style="display:flex; gap:8px; margin-top:8px;">
              <button class="secondary" data-role="Admin">Switch to Admin</button>
              <button class="secondary" data-role="Operator">Switch to Operator</button>
              <button class="secondary" data-role="Viewer">Switch to Viewer</button>
            </div>
          </div>
        </div>
        <div class="card">
          <div class="card-header"><span>AllowedToSignClaims</span></div>
          <div class="card-body">
            ${(G.state.allowedClaims).map(c=>`<div class="chip">${c}</div>`).join('')}
          </div>
        </div>
        <div class="card">
          <div class="card-header"><span>Permissions</span></div>
          <div class="card-body">
            <div>Can Deploy: <strong>${G.canDeploy()?'Yes':'No'}</strong></div>
            <div class="text-dim" style="font-size:12px; margin-top:8px;">
              Deployment enabled if user role is Admin OR user claim intersects AllowedToSignClaims.
            </div>
          </div>
        </div>
      </div>
    `;
  }
  render();

  G.delegate(main,'[data-role]','click',(e,btn)=>{
    const role = btn.getAttribute('data-role');
    G.state.currentUser.roles = [role];
    render();
  });
  G.sub('data:replace', ()=> location.reload());
})(window.GMS);
</script>
</body>
</html>
